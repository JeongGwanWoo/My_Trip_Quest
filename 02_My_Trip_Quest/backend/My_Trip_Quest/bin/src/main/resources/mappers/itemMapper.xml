<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mytripquest.domain.item.repository.ItemMapper">

    <select id="findItemById" parameterType="long" resultType="com.mytripquest.domain.item.entity.Item">
        SELECT item_id, name, description, type, slot, image_url, is_purchasable, price, created_at, updated_at
        FROM items
        WHERE item_id = #{itemId}
    </select>

    <select id="findUserItemsByUserId" parameterType="long" resultType="com.mytripquest.domain.item.entity.UserItem">
        SELECT user_id, item_id, quantity, is_equipped, acquired_at, updated_at
        FROM user_items
        WHERE user_id = #{userId}
    </select>

    <select id="findUserItem" resultType="com.mytripquest.domain.item.entity.UserItem">
        SELECT user_id, item_id, quantity, is_equipped, acquired_at, updated_at
        FROM user_items
        WHERE user_id = #{userId} AND item_id = #{itemId}
    </select>

    <select id="findEquippedItemBySlot" resultType="com.mytripquest.domain.item.entity.UserItem">
        SELECT ui.*
        FROM user_items ui
        JOIN items i ON ui.item_id = i.item_id
        WHERE ui.user_id = #{userId}
          AND ui.is_equipped = TRUE
          AND i.slot = #{slot}
    </select>

    <update id="updateUserItem" parameterType="com.mytripquest.domain.item.entity.UserItem">
        UPDATE user_items
        SET quantity = #{quantity},
            is_equipped = #{isEquipped}
        WHERE user_id = #{userId} AND item_id = #{itemId}
    </update>

</mapper>
